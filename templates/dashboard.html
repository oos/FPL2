<!DOCTYPE html>
<html>
<head>
  <title>FPL Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body{background:#f8f9fa}
    .card{box-shadow:0 2px 10px rgba(0,0,0,.08)}
    .badge-pos{font-size:.75rem;padding:.3rem .45rem}
    .gk{background:#dc3545;color:#fff}.def{background:#007bff;color:#fff}.mid{background:#28a745;color:#fff}.fwd{background:#ffc107;color:#212529}
    .fdr-badge{padding:4px 8px;border-radius:6px;color:#fff;font-weight:700}
    /* Keep links default color (not blue) across dashboard tables */
    .table a,
    .table a:visited,
    .table a:hover,
    .table a:active,
    .table a:focus { color: inherit !important; text-decoration: none !important; }
  </style>
</head>
<body class="p-4">
  {% include '_navbar.html' %}

  <div class="container">
    <div class="row g-3">
      <div class="col-lg-4">
        <div class="card p-3">
          <h4 class="mb-1">Upcoming Gameweek</h4>
          <div class="mb-2">GW: <strong>{{ upcoming_gw }}</strong></div>
          <h5 class="mt-2">All Fixtures (GW{{ upcoming_gw }})</h5>
          <div class="text-muted" style="font-size: 0.9rem;">Showing {{ all_fixtures|length }} fixtures</div>
          <div class="table-responsive">
            <table class="table table-sm">
              <tbody>
                {% set color_map = {1:'#234f1e', 2:'#4a7c59', 3:'#f39c12', 4:'#e74c3c', 5:'#8b0000'} %}
                {% for f in all_fixtures %}
                <tr>
                  <td class="text-end pe-2">{% if team_id_by_name.get(f.home_team) %}<a href="/team/{{ team_id_by_name.get(f.home_team) }}" class="text-decoration-none">{{ f.home_team }}</a>{% else %}{{ f.home_team }}{% endif %}</td>
                  <td><span class="fdr-badge" style="background: {{ color_map.get(f.home_difficulty, '#6c757d') }}">{{ f.home_difficulty }}</span></td>
                  <td class="px-2">vs</td>
                  <td><span class="fdr-badge" style="background: {{ color_map.get(f.away_difficulty, '#6c757d') }}">{{ f.away_difficulty }}</span></td>
                  <td class="ps-2">{% if team_id_by_name.get(f.away_team) %}<a href="/team/{{ team_id_by_name.get(f.away_team) }}" class="text-decoration-none">{{ f.away_team }}</a>{% else %}{{ f.away_team }}{% endif %}</td>
                </tr>
                {% endfor %}
                {% if all_fixtures|length == 0 %}
                <tr><td colspan="5" class="text-muted">No fixtures found for this GW.</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
        
      </div>
      <div class="col-lg-8">
        <div class="card p-3">
          <h4 class="mb-2">Suggested XI (GW{{ upcoming_gw }})</h4>
          <div class="mb-2">Formation: <strong>{{ formation }}</strong> | Team Points: <strong>{{ '%.1f'|format(gw_points) }}</strong></div>
          <div class="table-responsive">
            <table class="table table-sm table-striped">
              <thead><tr><th>Name</th><th>Pos</th><th>Team</th><th>xP</th></tr></thead>
              <tbody>
                {% for p in xi %}
                {% set poscls = 'gk' if p.position=='Goalkeeper' else ('def' if p.position=='Defender' else ('mid' if p.position=='Midfielder' else 'fwd')) %}
                <tr>
                  <td><a href="/player/{{ p.id }}" class="text-decoration-none">{{ p.name }}</a></td>
                  <td><span class="badge badge-pos {{ poscls }}">{{ p.position[0:3] }}</span></td>
                  <td>{% if p.team_id %}<a href="/team/{{ p.team_id }}" class="text-decoration-none">{{ p.team }}</a>{% else %}{{ p.team }}{% endif %}</td>
                  <td>{{ '%.1f'|format(p['gw' ~ upcoming_gw ~ '_points'] | default(0.0)) }}</td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <th colspan="3" class="text-end">Total xP</th>
                  <th>{{ '%.1f'|format(gw_points) }}</th>
                </tr>
              </tfoot>
            </table>
          </div>
          <h5 class="mt-3">Bench</h5>
          <ul>
            {% for p in bench %}
            <li><a href="/player/{{ p.id }}" class="text-decoration-none">{{ p.name }}</a> ({{ p.position }})</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</body>
</html>


